<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Disk B-Spline Test Harness</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .curve-container {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
    }
    .controls {
      margin-bottom: 10px;
    }
    h2 {
      margin-top: 0;
    }
    svg {
      background-color: #f8f8f8;
    }
    .log {
      font-family: monospace;
      background-color: #f0f0f0;
      padding: 10px;
      border-radius: 5px;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h1>Disk B-Spline Test Harness</h1>
  
  <div class="controls" style="margin-bottom: 20px;">
    <label><input type="checkbox" id="showSkeletonToggle" checked> Show Skeleton Path</label>
    <label style="margin-left: 20px;"><input type="checkbox" id="showNormalsToggle" checked> Show Normal Vectors</label>
    <label style="margin-left: 20px;"><input type="checkbox" id="showControlDisksToggle" checked> Show Control Disks</label>
  </div>
  
  <div class="container">
    <div class="curve-container">
      <h2>Example 1: Simple Variable Width Curve</h2>
      <div id="example1"></div>
    </div>
    
    <div class="curve-container">
      <h2>Example 2: Complex Variable Width Curve</h2>
      <div id="example2"></div>
    </div>
    
    <div class="curve-container">
      <h2>Example 3: Calligraphic Stroke</h2>
      <div id="example3"></div>
    </div>
    
    <div class="curve-container">
      <h2>Example 4: Calligraphic Effect</h2>
      <div id="example4"></div>
    </div>

    <div class="curve-container">
      <h2>Example 5: Interactive Curve</h2>
      <div class="controls">
        <button id="addDiskBtn">Add Disk</button>
        <button id="clearBtn">Clear</button>
      </div>
      <div id="example5"></div>
    </div>
    
    <div>
      <h2>Debug Log</h2>
      <div id="log" class="log"></div>
    </div>
  </div>

  <!-- Import the DiskBSpline library -->
  <script src="../index.js"></script>
  
  <script>
    // Helper function to create SVG content
    function createSVG(width, height, content) {
      return `<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">
        ${content}
      </svg>`;
    }

    // Generate Example 1: Simple Variable Width Curve
    function createExample1() {
      const container = document.getElementById('example1');
      
      // Create control disks
      const controlDisks = [
        { center: { x: 50, y: 150 }, radius: 10 },
        { center: { x: 150, y: 50 }, radius: 25 },
        { center: { x: 250, y: 150 }, radius: 15 },
        { center: { x: 350, y: 100 }, radius: 5 }
      ];
      
      // Create B-spline
      const bspline = new DiskBSpline(controlDisks);
      
      // Get toggle states
      const showSkeleton = document.getElementById('showSkeletonToggle').checked;
      const showNormals = document.getElementById('showNormalsToggle').checked;
      const showControlDisks = document.getElementById('showControlDisksToggle').checked;
      
      // Generate paths
      const result = bspline.toSVGPath(100);
      const controlCircles = showControlDisks ? bspline.controlDisksToSVG() : '';
      
      // Add normal vectors visualization if enabled
      let normalLines = '';
      
      if (showNormals) {
        for (let i = 0; i < result.disks.length; i += Math.floor(result.disks.length / 15)) {
          const disk = result.disks[i];
          const normal = result.normals[i];
          
          normalLines += `<line x1="${disk.center.x}" y1="${disk.center.y}" 
                               x2="${disk.center.x + normal.x * disk.radius}" 
                               y2="${disk.center.y + normal.y * disk.radius}" 
                               stroke="blue" stroke-width="1.5" />`;
          normalLines += `<line x1="${disk.center.x}" y1="${disk.center.y}" 
                               x2="${disk.center.x - normal.x * disk.radius}" 
                               y2="${disk.center.y - normal.y * disk.radius}" 
                               stroke="red" stroke-width="1.5" />`;
        }
      }
      
      // Create the skeleton path element if enabled
      const skeletonPathElement = showSkeleton ? 
        `<path d="${result.skeletonPath}" fill="none" stroke="#333" stroke-width="2" class="skeleton-path" />` : '';
      
      const svgContent = `
        <path d="${result.fillPath}" fill="steelblue" stroke="none" />
        ${skeletonPathElement}
        ${controlCircles}
        ${normalLines}
      `;
      
      // Create SVG
      container.innerHTML = createSVG(400, 200, svgContent);
    }

    // Generate Example 2: Complex Variable Width Curve
    function createExample2() {
      const container = document.getElementById('example2');
      
      // Create control disks with varying radii
      const controlDisks = [
        { center: { x: 50, y: 100 }, radius: 5 },
        { center: { x: 100, y: 50 }, radius: 20 },
        { center: { x: 150, y: 150 }, radius: 30 },
        { center: { x: 200, y: 60 }, radius: 15 },
        { center: { x: 250, y: 120 }, radius: 25 },
        { center: { x: 300, y: 80 }, radius: 10 },
        { center: { x: 350, y: 100 }, radius: 5 }
      ];
      
      // Create B-spline
      const bspline = new DiskBSpline(controlDisks);
      
      // Get toggle states
      const showSkeleton = document.getElementById('showSkeletonToggle').checked;
      const showNormals = document.getElementById('showNormalsToggle').checked;
      const showControlDisks = document.getElementById('showControlDisksToggle').checked;
      
      // Generate paths
      const result = bspline.toSVGPath(100);
      const controlCircles = showControlDisks ? bspline.controlDisksToSVG() : '';
      
      // Add normal vectors visualization if enabled
      let normalLines = '';
      
      if (showNormals) {
        for (let i = 0; i < result.disks.length; i += Math.floor(result.disks.length / 15)) {
          const disk = result.disks[i];
          const normal = result.normals[i];
          
          normalLines += `<line x1="${disk.center.x}" y1="${disk.center.y}" 
                               x2="${disk.center.x + normal.x * disk.radius}" 
                               y2="${disk.center.y + normal.y * disk.radius}" 
                               stroke="blue" stroke-width="1.5" />`;
          normalLines += `<line x1="${disk.center.x}" y1="${disk.center.y}" 
                               x2="${disk.center.x - normal.x * disk.radius}" 
                               y2="${disk.center.y - normal.y * disk.radius}" 
                               stroke="red" stroke-width="1.5" />`;
        }
      }
      
      // Create the skeleton path element if enabled
      const skeletonPathElement = showSkeleton ? 
        `<path d="${result.skeletonPath}" fill="none" stroke="#333" stroke-width="2" class="skeleton-path" />` : '';
      
      const svgContent = `
        <path d="${result.fillPath}" fill="purple" stroke="none" opacity="0.7" />
        ${skeletonPathElement}
        ${controlCircles}
        ${normalLines}
      `;
      
      // Create SVG
      container.innerHTML = createSVG(400, 200, svgContent);
    }

    // Generate Example 3: Calligraphic Stroke
    function createExample3() {
      const container = document.getElementById('example3');
      
      // Create control disks to simulate a calligraphic stroke
      const controlDisks = [
        { center: { x: 50, y: 100 }, radius: 3 },
        { center: { x: 100, y: 120 }, radius: 10 },
        { center: { x: 150, y: 80 }, radius: 15 },
        { center: { x: 200, y: 150 }, radius: 20 },
        { center: { x: 250, y: 50 }, radius: 15 },
        { center: { x: 300, y: 120 }, radius: 10 },
        { center: { x: 350, y: 100 }, radius: 3 }
      ];
      
      // Create B-spline
      const bspline = new DiskBSpline(controlDisks);
      
      // Get toggle states
      const showSkeleton = document.getElementById('showSkeletonToggle').checked;
      const showNormals = document.getElementById('showNormalsToggle').checked;
      const showControlDisks = document.getElementById('showControlDisksToggle').checked;
      
      // Generate paths
      const result = bspline.toSVGPath(100);
      const controlCircles = showControlDisks ? bspline.controlDisksToSVG() : '';
      
      // Add normal vectors visualization if enabled
      let normalLines = '';
      
      if (showNormals) {
        for (let i = 0; i < result.disks.length; i += Math.floor(result.disks.length / 15)) {
          const disk = result.disks[i];
          const normal = result.normals[i];
          
          normalLines += `<line x1="${disk.center.x}" y1="${disk.center.y}" 
                               x2="${disk.center.x + normal.x * disk.radius}" 
                               y2="${disk.center.y + normal.y * disk.radius}" 
                               stroke="blue" stroke-width="1.5" />`;
          normalLines += `<line x1="${disk.center.x}" y1="${disk.center.y}" 
                               x2="${disk.center.x - normal.x * disk.radius}" 
                               y2="${disk.center.y - normal.y * disk.radius}" 
                               stroke="red" stroke-width="1.5" />`;
        }
      }
      
      // Create the skeleton path element if enabled
      const skeletonPathElement = showSkeleton ? 
        `<path d="${result.skeletonPath}" fill="none" stroke="#333" stroke-width="2" class="skeleton-path" />` : '';
      
      const svgContent = `
        <path d="${result.fillPath}" fill="black" stroke="none" />
        ${skeletonPathElement}
        ${controlCircles}
        ${normalLines}
      `;
      
      // Create SVG
      container.innerHTML = createSVG(400, 200, svgContent);
    }

    // Generate Example 4: Calligraphic Effect
    function createExample4() {
      const container = document.getElementById('example4');
      
      // Create control disks to simulate a calligraphic pen stroke
      // Disks vary from thin to thick and back to thin to show dramatic variable width
      const controlDisks = [
        { center: { x: 50, y: 100 }, radius: 3 },
        { center: { x: 100, y: 80 }, radius: 8 },
        { center: { x: 150, y: 50 }, radius: 20 },
        { center: { x: 200, y: 80 }, radius: 30 },
        { center: { x: 250, y: 150 }, radius: 15 },
        { center: { x: 300, y: 120 }, radius: 7 },
        { center: { x: 350, y: 100 }, radius: 3 }
      ];
      
      // Create B-spline
      const bspline = new DiskBSpline(controlDisks);
      
      // Get toggle states
      const showSkeleton = document.getElementById('showSkeletonToggle').checked;
      const showNormals = document.getElementById('showNormalsToggle').checked;
      const showControlDisks = document.getElementById('showControlDisksToggle').checked;
      
      // Generate paths
      const result = bspline.toSVGPath(100);
      const controlCircles = showControlDisks ? bspline.controlDisksToSVG() : '';
      
      // Add normal vectors visualization if enabled
      let normalLines = '';
      
      if (showNormals) {
        for (let i = 0; i < result.disks.length; i += Math.floor(result.disks.length / 15)) {
          const disk = result.disks[i];
          const normal = result.normals[i];
          
          normalLines += `<line x1="${disk.center.x}" y1="${disk.center.y}" 
                               x2="${disk.center.x + normal.x * disk.radius}" 
                               y2="${disk.center.y + normal.y * disk.radius}" 
                               stroke="blue" stroke-width="1.5" />`;
          normalLines += `<line x1="${disk.center.x}" y1="${disk.center.y}" 
                               x2="${disk.center.x - normal.x * disk.radius}" 
                               y2="${disk.center.y - normal.y * disk.radius}" 
                               stroke="red" stroke-width="1.5" />`;
        }
      }
      
      // Create the skeleton path element if enabled
      const skeletonPathElement = showSkeleton ? 
        `<path d="${result.skeletonPath}" fill="none" stroke="#333" stroke-width="2" class="skeleton-path" />` : '';
      
      const svgContent = `
        <path d="${result.fillPath}" fill="#333" stroke="none" />
        ${skeletonPathElement}
        ${controlCircles}
        ${normalLines}
      `;
      
      // Create SVG
      container.innerHTML = createSVG(400, 200, svgContent);
    }

    // Generate Example 5: Interactive Curve
    function createExample5() {
      const container = document.getElementById('example5');
      const width = 400;
      const height = 200;
      
      // Create initial control disks (need at least 4 for cubic B-spline)
      const controlDisks = [
        { center: { x: 50, y: 100 }, radius: 10 },
        { center: { x: 150, y: 100 }, radius: 15 },
        { center: { x: 250, y: 100 }, radius: 20 },
        { center: { x: 350, y: 100 }, radius: 10 }
      ];
      
      // Create B-spline
      const bspline = new DiskBSpline(controlDisks);
      
      // Function to update the SVG
      function updateSVG() {
        // Get toggle states
        const showSkeleton = document.getElementById('showSkeletonToggle').checked;
        const showNormals = document.getElementById('showNormalsToggle').checked;
        const showControlDisks = document.getElementById('showControlDisksToggle').checked;
        
        // Generate paths
        const result = bspline.toSVGPath(100);
        const controlCircles = showControlDisks ? bspline.controlDisksToSVG() : '';
        
        // Add normal vectors visualization if enabled
        let normalLines = '';
        
        if (showNormals) {
          for (let i = 0; i < result.disks.length; i += Math.floor(result.disks.length / 15)) {
            const disk = result.disks[i];
            const normal = result.normals[i];
            
            normalLines += `<line x1="${disk.center.x}" y1="${disk.center.y}" 
                                 x2="${disk.center.x + normal.x * disk.radius}" 
                                 y2="${disk.center.y + normal.y * disk.radius}" 
                                 stroke="blue" stroke-width="1.5" />`;
            normalLines += `<line x1="${disk.center.x}" y1="${disk.center.y}" 
                                 x2="${disk.center.x - normal.x * disk.radius}" 
                                 y2="${disk.center.y - normal.y * disk.radius}" 
                                 stroke="red" stroke-width="1.5" />`;
          }
        }
        
        // Create the skeleton path element if enabled
        const skeletonPathElement = showSkeleton ? 
          `<path d="${result.skeletonPath}" fill="none" stroke="#333" stroke-width="2" class="skeleton-path" />` : '';
        
        const svgContent = `
          <path d="${result.fillPath}" fill="green" stroke="none" opacity="0.7" />
          ${skeletonPathElement}
          ${controlCircles}
          ${normalLines}
        `;
        
        // Create SVG
        container.innerHTML = createSVG(width, height, svgContent);
        
        // Add event listener to the SVG
        const svg = container.querySelector('svg');
        svg.addEventListener('click', (event) => {
          // Get click coordinates relative to the SVG
          const rect = svg.getBoundingClientRect();
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;
          
          // Add a new control disk
          bspline.addDisk({ 
            center: { x, y }, 
            radius: 10 + Math.random() * 10 
          });
          
          // Update the SVG
          updateSVG();
        });
      }
      
      // Initial update
      updateSVG();
      
      // Add event listeners to buttons
      document.getElementById('addDiskBtn').addEventListener('click', () => {
        const lastDisk = bspline.controlDisks[bspline.controlDisks.length - 1];
        const x = lastDisk ? lastDisk.center.x + 50 : 100;
        const y = lastDisk ? lastDisk.center.y : 100;
        
        bspline.addDisk({ 
          center: { x: x % width, y: y % height }, 
          radius: 10 + Math.random() * 10 
        });
        
        updateSVG();
      });
      
      document.getElementById('clearBtn').addEventListener('click', () => {
        // Reset to initial disks (need at least 4 for cubic B-spline)
        bspline.controlDisks = [
          { center: { x: 50, y: 100 }, radius: 10 },
          { center: { x: 150, y: 100 }, radius: 15 },
          { center: { x: 250, y: 100 }, radius: 20 },
          { center: { x: 350, y: 100 }, radius: 10 }
        ];
        bspline.generateUniformKnots();
        bspline.logMessage("Cleared control disks and reset to initial state");
        
        updateSVG();
      });
    }

    // Function to redraw all examples
    function redrawAllExamples() {
      createExample1();
      createExample2();
      createExample3();
      createExample4();
      createExample5();
    }

    // Initialize all examples
    createExample1();
    createExample2();
    createExample3();
    createExample4();
    createExample5();
    
    // Add event listeners for the toggle options
    document.getElementById('showSkeletonToggle').addEventListener('change', redrawAllExamples);
    document.getElementById('showNormalsToggle').addEventListener('change', redrawAllExamples);
    document.getElementById('showControlDisksToggle').addEventListener('change', redrawAllExamples);
  </script>
</body>
</html>